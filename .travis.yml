language: bash

env:
    global:
      - VERSION=2.${TRAVIS_BUILD_NUMBER}
      - DOCKER_LOCAL="${LOWERCASE_REPO_SLUG}:${TRAVIS_COMMIT}"

jobs:
    include:
    - stage: Build and deploy gateway
      script:
        - cd Gateway
        - docker build -t gateway .
        - docker tag gateway caspha17/gateway:${VERSION}
        - docker login -u caspha17 --password $dockerLogin
        - docker push caspha17/gateway:${VERSION} 
    - stage: Build and deploy spa
      script:
        - cd SPA
        - docker build -t spa . 
        - docker tag spa caspha17/spa:${VERSION}
        - docker login -u caspha17 --password $dockerLogin
        - docker push caspha17/spa:${VERSION} 
    - stage: Build and deploy worker2
      script:
        - cd example-worker2
        - docker build -t worker2 . 
        - docker tag worker2 caspha17/worker2:${VERSION}
        - docker login -u caspha17 --password $dockerLogin
        - docker push caspha17/worker2:${VERSION} 

